<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<record model="ir.ui.view" id="view_order_form">
		<field name="model">sale.order</field>
		<field name="name">sale.order.form</field>
		<field name="inherit_id" ref="sale.view_order_form"/>
		<field name="arch" type="xml">

			<!-- Hide Send by Email / Send PRO-FORMA Invoice / Confirm button -->
			<xpath expr="//header/button[@name='action_quotation_send' and @states='draft' and hasclass('btn-primary')]" position="replace"/>
			<xpath expr="//header/button[@name='action_quotation_send' and @states='sent,sale']" position="replace"/>
			<xpath expr="//header/button[@name='action_quotation_send' and hasclass('btn-primary')]" position="replace"/>
			<xpath expr="//header/button[@name='action_quotation_send']" position="replace"/>
			<xpath expr="//header/button[@name='action_confirm' and hasclass('btn-primary')]" position="replace"/>
			<xpath expr="//header/button[@name='action_confirm']" position="replace"/>

			<!-- Add custom button action_send for moving from 'draft' to 'sent' without calling wizards. -->
			<xpath expr="//header/button[@name='action_cancel']" position="before">
				<button name="action_send" type="object" string="Send" states="draft" class="btn-primary" help="Proceed to next step to send quotation or pro-forma."/>
			</xpath>

			<!-- Add custom smart button for moving from 'sent' to 'sale'/'lock'  -->
			<xpath expr="//div[@name='button_box']">
				<button name="action_confirm_sale_order" type="object" class="oe_statbutton" icon="fa-linux" attrs="{'invisible': [('state', 'not in', ['sent'])]}"/>
			</xpath>

			<!-- 'readonly' is not universally defined in .py or .xml, implementation of each field are different. 
			This section modify 'readonly' from front end coherently.  -->
			<xpath expr="//field[@name='partner_id']" position="attributes">
				<attribute name="attrs">{'readonly': [('state', 'not in', ['draft'])]}</attribute>
			</xpath>
			<xpath expr="//field[@name='pricelist_id']" position="attributes">
				<attribute name="attrs">{'readonly': [('state', 'not in', ['draft'])]}</attribute>
			</xpath>

			<!-- This field show if all order lines are notified for tally or not, readonly set in .py with compute based on order_line.tally. -->
			<xpath expr="//group[@name='sale_shipping']">
				<field name="tally"/>
			</xpath>

			<!-- When click on one2many field order_line, show tally based on state -->
			<xpath expr="//form/group/group">
				<label for="tally" string="Tally" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
				<div name="tally" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
					<field name="tally"/>
				</div>
			</xpath>

			<!-- Show tally in tree view on one2many field order_line -->
			<xpath expr="//tree">
				<field name="tally" string="Tally" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}" optional="show"/>
			</xpath>

		</field>
	</record>

</odoo>