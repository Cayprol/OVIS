<?xml version="1.0" encoding="utf-8" ?>

<odoo>
	<data>

		<record model="ir.ui.view" id="view_order_form_ovis">
			<field name="model">sale.order</field>
			<field name="name">sale.view.order.form.ovis</field>
			<field name="inherit_id" ref="sale.view_order_form"></field>
			<field name="arch" type="xml">

				<xpath expr="//field[@name='partner_id']" position="after">
					<field name="is_prepare" string="is_prepare"/>
					<field name="state" string="state" readonly="1"/>
				</xpath>				
	
				<xpath expr="//button[@name='action_cancel']" position="after">
					<button name="action_prepare_material" type="object" string="MP"/>
				</xpath>

				<xpath expr="//button[@name='action_cancel']" position="attributes">
					<attribute name="states">draft,sent,sale,material_prepare</attribute>
				</xpath>

			</field>
		</record>
		<!-- Adding view action OVIS_material_prepare_menu -->
		<record id="view_material_prepare_tree" model="ir.ui.view">
			<field name="name">material.prepare.order.tree</field>
			<field name="model">sale.order</field>
			<field name="priority">4</field>
			<field name="arch" type="xml">
				<tree string="Quotation" class="o_sale_order" decoration-bf="message_needaction==True" decoration-muted="state=='cancel'">
					<field name="message_needaction" invisible="1"/>
					<field name="name" string="Quotation Number"/>
					<field name="date_order" string="Quotation Date"/>
					<field name="partner_id"/>
					<field name="user_id"/>
					<field name="amount_total" sum="Total Tax Included" widget="monetary"/>
					<field name="currency_id" invisible="1"/>
					<field name="state"/>
				</tree>
			</field>
		</record>

		<!-- Adding action for menuitem -->
		<record id="OVIS_material_prepare_menu" model="ir.actions.act_window">
			<field name="name">Material Prepare</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">sale.order</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
			<field name="search_view_id" ref="sale.sale_order_view_search_inherit_sale"/>
			<field name="context">{}</field>
			<field name="domain">[('state', 'in', ['material_prepare'])]</field>
		</record>
<!-- <tree string="Quotation" class="o_sale_order" decoration-bf="message_needaction==True" decoration-muted="state=='cancel'" modifiers="{}">
	<field name="message_needaction" invisible="1" modifiers="{'readonly':true,'column_invisible':true}"/>
	<field name="name" string="Quotation Number" modifiers="{'readonly':[['state','not in',['draft']]],'required':true}"/>
	<field name="date_order" string="Quotation Date" modifiers="{'readonly':[['state','not in',['sent','draft']]],'required':true}"/>
	<field name="partner_id" on_change="1" can_create="true" can_write="true" modifiers="{'readonly':[['state','not in',['sent','draft']]],'required':true}"/>
	<field name="user_id" can_create="true" can_write="true" modifiers="{}"/>
	<field name="amount_total" sum="Total Tax Included" widget="monetary" modifiers="{'readonly':true}"/>
	<field name="currency_id" invisible="1" can_create="true" can_write="true" modifiers="{'readonly':true,'required':true,'column_invisible':true}"/>
	<field name="state" modifiers="{'readonly':true}"/>
</tree> -->

		<!-- Adding menuitem to dispaly -->
		<menuitem id="material_prepare" name="Material Prepare" parent="sale.sale_order_menu" sequence="4" action="OVIS_material_prepare_menu"/>

	</data>
</odoo>
