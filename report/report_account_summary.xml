<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

	<template id="report_account_summary">
		<t t-call="web.html_container">
			<t t-call="web.internal_layout" t-lang="request.env.user.partner_id.lang">
				<div class="page">
<!-- 					<div>
						<p>Report Generated On: <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/></p>
					</div> -->
					<t t-set="companies" t-value="list(set([o.partner_id for o in docs if o.state!='draft' and o.state!='cancel']))"/>
					<t t-set="type" t-value="list(set([o.type for o in docs if o.state!='draft' and o.state!='cancel']))"/>

					<div class="row">
					<t t-if="len(type) == 1 and type[0] == 'out_invoice'">
						<h3 align="center"><strong>Receivable</strong></h3>
					</t>
					<t t-elif="len(type) == 1 and type[0] == 'in_invoice'">
						<h3 align="center"><strong>Payable</strong></h3>
					</t>
					<t t-else="">
						<h3 align="center"><strong>Receivable / Payable</strong></h3>
					</t>

						<table class="table table-condensed">				
							<t t-foreach="companies" t-as="c">
									<thead>
										<tr>
											<th><strong>Partner</strong></th>
											<th><strong>Invoice No.</strong></th>
											<th><strong>Amount</strong></th>
											<th><strong>Tax</strong></th>
											<th><strong>Total</strong></th>
											<th t-if="len(type) == 1 and type[0] == 'out_invoice'">
												<strong>To Collect</strong>
											</th>											
											<th t-elif="len(type) == 1 and type[0] == 'in_invoice'">
												<strong>To Pay</strong>
											</th>
											<th t-else="">
												<strong>Pay/Collect</strong>
											</th>
											<th><strong>Due Date</strong></th>
											<th><strong>Term</strong></th>
										</tr>								
									</thead>
									<tbody>
										<tr t-foreach="docs" t-as="o" t-if="o.state!='draft' and o.state!='cancel' and c.id == o.partner_id.id">
											<td><span t-field="o.partner_id"/></td>
											<td><span t-field="o.number"/></td>
											<td><span t-field="o.amount_untaxed"/></td>
											<td><span t-field="o.amount_tax"/></td>
											<td><span t-field="o.amount_total_signed"/></td>
											<td><span t-field="o.residual_signed"/></td>
											<td><span t-field="o.date_due"/></td>
											<td><span t-field="o.payment_term_id.line_ids.days"/></td>
										</tr>
										<tr>
											<td/>
											<td class="text-right"><span>Subtotal:</span></td>
											<td><span t-esc="round(sum([o.amount_untaxed for o in docs if c.id == o.partner_id.id]), 2)"/></td>
											<td><span t-esc="round(sum([o.amount_tax for o in docs if c.id == o.partner_id.id]), 2)"/></td>
											<td><span t-esc="round(sum([o.amount_total_signed for o in docs if c.id == o.partner_id.id]), 2)"/></td>
											<td><span t-esc="round(sum([o.residual_signed for o in docs if c.id == o.partner_id.id]), 2)"/></td>
											<td/>
											<td/>
										</tr>
									</tbody>
							</t>
						</table>
					</div>

					<div class="row" style="page-break-inside: avoid; margin-top:48px;">


						<h3 align="center"><strong>Grand Total</strong></h3>
						<table class="table table-condensed table-bordered">
							
							<thead>
								<th/>
								<th><strong>Amount</strong></th>
								<th><strong>Tax</strong></th>
								<th><strong>Total</strong></th>
								<th t-if="len(type) == 1 and type[0] == 'out_invoice'">
									<strong>To Collect</strong>
								</th>											
								<th t-elif="len(type) == 1 and type[0] == 'in_invoice'">
									<strong>To Pay</strong>
								</th>
								<th t-else="">
									<strong>Pay/Collect</strong>
								</th>
							</thead>
							
							<thead>
								<th t-att-colspan="5"><h6><strong>Original Currency</strong></h6></th>
							</thead>

							<tbody>
								<t t-set="EUR_amount_untaxed" t-value="round(sum([o.amount_untaxed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_untaxed" t-value="round(sum([o.amount_untaxed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_untaxed" t-value="round(sum([o.amount_untaxed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_untaxed" t-value="round(sum([o.amount_untaxed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_untaxed" t-value="round(sum([o.amount_untaxed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_amount_tax" t-value="round(sum([o.amount_tax for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_tax" t-value="round(sum([o.amount_tax for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_tax" t-value="round(sum([o.amount_tax for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_tax" t-value="round(sum([o.amount_tax for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_tax" t-value="round(sum([o.amount_tax for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_amount_total_signed" t-value="round(sum([o.amount_total_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_total_signed" t-value="round(sum([o.amount_total_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_total_signed" t-value="round(sum([o.amount_total_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_total_signed" t-value="round(sum([o.amount_total_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_total_signed" t-value="round(sum([o.amount_total_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_residual_signed" t-value="round(sum([o.residual_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_residual_signed" t-value="round(sum([o.residual_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_residual_signed" t-value="round(sum([o.residual_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_residual_signed" t-value="round(sum([o.residual_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_residual_signed" t-value="round(sum([o.residual_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>
								<tr>
									<td><span><strong>EUR</strong></span></td>
									<td><span t-esc="EUR_amount_untaxed"/></td>
									<td><span t-esc="EUR_amount_tax"/></td>
									<td><span t-esc="EUR_amount_total_signed"/></td>
									<td><span t-esc="EUR_residual_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>USD</strong></span></td>
									<td><span t-esc="USD_amount_untaxed"/></td>
									<td><span t-esc="USD_amount_tax"/></td>
									<td><span t-esc="USD_amount_total_signed"/></td>
									<td><span t-esc="USD_residual_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>CNY</strong></span></td>
									<td><span t-esc="CNY_amount_untaxed"/></td>
									<td><span t-esc="CNY_amount_tax"/></td>
									<td><span t-esc="CNY_amount_total_signed"/></td>
									<td><span t-esc="CNY_residual_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>HKD</strong></span></td>
									<td><span t-esc="HKD_amount_untaxed"/></td>
									<td><span t-esc="HKD_amount_tax"/></td>
									<td><span t-esc="HKD_amount_total_signed"/></td>
									<td><span t-esc="HKD_residual_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>TWD</strong></span></td>
									<td><span t-esc="TWD_amount_untaxed"/></td>
									<td><span t-esc="TWD_amount_tax"/></td>
									<td><span t-esc="TWD_amount_total_signed"/></td>
									<td><span t-esc="TWD_residual_signed"/></td>
								</tr>
							</tbody>
							<tbody>
								<t t-set="EUR_amount_untaxed_signed" t-value="round(sum([o.amount_untaxed_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_untaxed_signed" t-value="round(sum([o.amount_untaxed_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_untaxed_signed" t-value="round(sum([o.amount_untaxed_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_untaxed_signed" t-value="round(sum([o.amount_untaxed_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_untaxed_signed" t-value="round(sum([o.amount_untaxed_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_amount_tax_signed" t-value="round(sum([o.amount_tax_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_tax_signed" t-value="round(sum([o.amount_tax_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_tax_signed" t-value="round(sum([o.amount_tax_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_tax_signed" t-value="round(sum([o.amount_tax_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_tax_signed" t-value="round(sum([o.amount_tax_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_amount_total_company_signed" t-value="round(sum([o.amount_total_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_amount_total_company_signed" t-value="round(sum([o.amount_total_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_amount_total_company_signed" t-value="round(sum([o.amount_total_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_amount_total_company_signed" t-value="round(sum([o.amount_total_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_amount_total_company_signed" t-value="round(sum([o.amount_total_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>

								<t t-set="EUR_residual_company_signed" t-value="round(sum([o.residual_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==1]), 2)"/>
								<t t-set="USD_residual_company_signed" t-value="round(sum([o.residual_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==3]), 2)"/>
								<t t-set="CNY_residual_company_signed" t-value="round(sum([o.residual_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==8]), 2)"/>
								<t t-set="HKD_residual_company_signed" t-value="round(sum([o.residual_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==25]), 2)"/>
								<t t-set="TWD_residual_company_signed" t-value="round(sum([o.residual_company_signed for o in docs if o.state!='draft' and o.state!='cancel' and o.currency_id.id==140]), 2)"/>
								<tr>
									<td class="text-top" t-att-colspan="5"><h6><strong>Exchanged Currency</strong></h6></td>
								</tr>

								<tr>

									<td><span><strong>EUR</strong></span></td>
									<td><span t-esc="EUR_amount_untaxed_signed"/></td>
									<td><span t-esc="EUR_amount_tax_signed"/></td>
									<td><span t-esc="EUR_amount_total_company_signed"/></td>
									<td><span t-esc="EUR_residual_company_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>USD</strong></span></td>
									<td><span t-esc="USD_amount_untaxed_signed"/></td>
									<td><span t-esc="USD_amount_tax_signed"/></td>
									<td><span t-esc="USD_amount_total_company_signed"/></td>
									<td><span t-esc="USD_residual_company_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>CNY</strong></span></td>
									<td><span t-esc="CNY_amount_untaxed_signed"/></td>
									<td><span t-esc="CNY_amount_tax_signed"/></td>
									<td><span t-esc="CNY_amount_total_company_signed"/></td>
									<td><span t-esc="CNY_residual_company_signed"/></td>
								</tr>							
								<tr>
									<td><span><strong>HKD</strong></span></td>
									<td><span t-esc="HKD_amount_untaxed_signed"/></td>
									<td><span t-esc="HKD_amount_tax_signed"/></td>
									<td><span t-esc="HKD_amount_total_company_signed"/></td>
									<td><span t-esc="HKD_residual_company_signed"/></td>
								</tr>
								<tr>
									<td><span><strong>TWD</strong></span></td>
									<td><span t-esc="TWD_amount_untaxed_signed"/></td>
									<td><span t-esc="TWD_amount_tax_signed"/></td>
									<td><span t-esc="TWD_amount_total_company_signed"/></td>
									<td><span t-esc="TWD_residual_company_signed"/></td>
								</tr>
								<tr>
									<td class="text-right"><span>Subtotal (Exchanged):</span></td>
									<td><strong><span t-esc="round(EUR_amount_untaxed_signed+USD_amount_untaxed_signed+CNY_amount_untaxed_signed+HKD_amount_untaxed_signed+TWD_amount_untaxed_signed, 2)"/></strong></td>
									<td><strong><span t-esc="round(EUR_amount_tax_signed+USD_amount_tax_signed+CNY_amount_tax_signed+HKD_amount_tax_signed+TWD_amount_tax_signed, 2)"/></strong></td>
									<td><strong><span t-esc="round(EUR_amount_total_company_signed+USD_amount_total_company_signed+CNY_amount_total_company_signed+HKD_amount_total_company_signed+TWD_amount_total_company_signed, 2)"/></strong></td>
									<td><strong><span t-esc="round(EUR_residual_company_signed+USD_residual_company_signed+CNY_residual_company_signed+HKD_residual_company_signed+TWD_residual_company_signed, 2)"/></strong></td>				
								</tr>
							</tbody>			
						</table>
					</div>

				</div>
			</t>
		</t>
	</template>

</odoo>